<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>资源类配置</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="lib/layui/css/layui.css">
    <link rel="stylesheet" href="css/scroll-bar.css">
    <link rel="stylesheet" href="css/sub-page.css">
    <!--<link rel="stylesheet" href="//at.alicdn.com/t/font_693759_wytlyqhtdtj1nhfr.css">-->
    <link rel="stylesheet" href="lib/nprogress/nprogress.css">
    <link rel="stylesheet" href="css/page.css?2">
    <link rel="stylesheet" href="css/font-awesome.min.css">
</head>
<body>
<div class="layui-element" id="vue-element">
    <!--导航区域-->
    <div class="layui-tab">
        <ul class="layui-tab-title">
            <li class="layui-this">基础设施层</li>
            <li>虚拟资源层</li>
            <li>平台资源层</li>
            <li>业务应用层</li>
            <li>管理资源层</li>
        </ul>
        <!--导航内容-->
        <div class="layui-tab-content">
            <!--基础设施层start-->
            <div class="layui-tab-item layui-show">
                <div class="head-title-box">
                    <button class="layui-btn ">添加属性</button>
                    <button class="layui-btn layui-btn-primary">添加类关系</button>
                </div>
                <div class="layui-row">
                    <!--左边导航-->
                    <div class="layui-col-xs2 related">
                        <div class="left-nav-box bg-gary">
                        	<template>
                        		<div class="left-nav-item" v-for="item in left_nav" :key="item.id" :class="item.selected?'active':''" v-on:click="selectNav(item)">
	                                {{ item.name }}
	                                <img src="images/edit.png" v-on:click.stop="navEdit">
	                            </div>
	                            <div class="left-nav-btn">
	                                <button class="layui-btn layui-btn-sm">添加资源类</button>
	                            </div>
                        	</template>
                        </div>
                    </div>
                    <!--基本信息-->
                    <div class="layui-col-xs10">
                        <template class="layui-row">
                            <div class="layui-col-xs9">
                                <div class="form-box">
                                    <div class="form-head">
                                        基本信息
                                    </div>
                                    <drop class="form-item-box" @drop="handleDrop">
                                        <div class="form-item"
                                              v-for="item of cur_select.attr"
                                              >
                                            <div class="form-item-head">
                                                {{ item.title }}<span class="red" v-if='item.required'>*</span>：
                                            </div>
                                            <div class="form-item-center">
                                                <input v-if="item.type=='text'||item.type=='textarea'" v-model="item.value" type="text" name="title" autocomplete="off" :placeholder="'请输入' + item.title" class="layui-input"/>
                                            </div>
                                            <div class="form-item-right" v-if="item.hasRightText">
                                                * 名称为固定选项，不可去除；
                                            </div>
                                        </div>
                                    </drop>
                                </div>
                            </div>
                            <div class="layui-col-xs3">
                                <div class="drap-box">
                                    <drag class="drap-item"
                                          v-for="item of drap_icon"
                                          :key="item.title"
                                          :transfer-data="item"
                                          :effect-allowed="['copy']"
                                          drop-effect="copy"
                                    >
                                    <span>
                                        <img :src="item.src">
                                    </span>
                                        <span style="margin-top: 5px">
                                        {{ item.title }}
                                    </span>
                                    </drag>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
            <!--基础设施层end-->
            <div class="layui-tab-item">虚拟资源层</div>
            <div class="layui-tab-item">平台资源层</div>
            <div class="layui-tab-item">业务应用层</div>
            <div class="layui-tab-item">管理资源层</div>
        </div>
    </div>


    <!--拖拽弹窗-->
    <template v-if="msgBoxShow">
        <div class="msg-box" >
            <div class="msg-box-bg"></div>
            <div class="msg-content-box">
                <div class="msg-content-title">
                    添加属性 - {{ cur_drap.title }}
                    <i class="layui-icon layui-icon-close" v-on:click="msgBoxShow=false" style="float: right;cursor: pointer"></i>
                </div>
                <div class="msg-content">
                    <form class="layui-form 123">
                        <div class="msg-content-item" v-for="item of cur_drap.parm">
                            <div class="msg-content-item-title">
                                <span class="red" v-if="item.required">*</span>{{ item.lable }}：
                                <div v-if="item.type=='options'" class="layui-btn layui-btn-sm" style="float: right" v-on:click="addOption(item)">添加</div>
                            </div>
                            <div class="msg-content-item-input" v-if="item.name=='required'">
                                <input type="checkbox" name="close" v-model="item.value" ref="required" lay-skin="switch" lay-text="是|否">
                            </div>
                            <div class="msg-content-item-input" v-if="item.name=='required_data'">
                                <input type="checkbox" name="close" v-model="item.value" ref="required_data" lay-skin="switch" lay-text="是|否">
                            </div>
							<div class="msg-content-item-input" v-if="item.type=='dateTime'">
                                 <input type="text" class="layui-input" id="laydata" v-model="item.value" ref='dateTime' placeholder="yyyy-MM-dd">
                            </div>
                            <div class="msg-content-item-input" v-if="item.type=='text'||item.type=='number'">
                                <input :type="item.type" :placeholder="'请输入' + item.lable" v-model="item.value" autocomplete="off" class="layui-input">
                                <div v-if="item.name=='code'" class="msg-content-item-tips">请输入3-30个字母或数字，且首个字符必须为字母；</div>
                            </div>
                            <div class="msg-content-item-input" v-else-if="item.type=='select'&&(item.name=='rules'||item.name=='useobj')" >
                                <select name="rules" lay-verify="" v-model="item.value" ref="rules">
                                    <option value="111">无校验</option>
                                    <option value="010">IP地址</option>
                                    <option value="021">邮箱</option>
                                </select>
                            </div>
                            <div class="msg-content-item-input" v-else-if="item.type=='options'&&(item.name=='options'||item.name=='table')" >
                                <div v-for="(op,i) of item.options" :key="i" class="msg-content-item-pulldown">
                                    <i :class="op.isSelect?'fa fa-check-circle':'fa fa-circle-thin'" class="pulldown-hover" v-if="item.name=='options'" aria-hidden="true" v-on:click="checkOption(item,i)"></i>
                                    <input v-model="op.name" placeholder="请输入选项名称"/>
                                    <i class="fa fa-trash-o" v-on:click="item.options.splice(i,1)"></i>
                                </div>
                            </div>
                        </div>
                    </form>
                    <button class="layui-btn" @click="saveDrap">保存</button>
                </div>
            </div>
        </div>
    </template>

</div>
<!--js逻辑-->
<script src="lib/layui/layui.js"></script>
<script src="js/vue.min.js"></script>
<script src="lib/nprogress/nprogress.js"></script>
<!--拖拽-->
<script src="js/sortable.js"></script>
<script src="js/vuedraggable.js"></script>
<script src="js/vue-drag-drop.browser.js"></script>
<script>
    NProgress.start();
    window.onload = function () {
        NProgress.done();
    }


</script>
<!-- vueJs -->
<script>
    new Vue({
        el: '#vue-element',
        data() {
            return{
                /* 基础设施层 */
                // 左边导航
                left_nav:[{
                    id: 0,
                    name: '机房',
                    selected: true,
                    //属性 title.required,hasRightText,value
                    attr: [{
                        title: '名称',//显示title
                        type: 'text',//类型
                        required: true,//是否必填
                        hasRightText: true,//显示（名称为固定选项，不可去除；）
                        value:''//值
                    }],
                    //类关系
                    class: {

                    }
                },{
                    id: 1,
                    name: '机柜',
                    selected: false
                },{
                    id: 2,
                    name: 'PC服务器',
                    selected: false
                },],
                cur_select: {},
                cur_drap: {},
                msgBoxShow: false,
                // 拖拽图标
                drap_icon:[
                    {
                        title: "单行文本",
                        type: 'text',
                        src: 'images/d-text.png',
                        parm: [
                            {
                            name: 'name',
                            lable: '字段名称',
                            value: '',
                            type: 'text',
                            required: true
                        },{
                            name: 'default',
                            lable: '默认值',
                            value: '',
                            type: 'text',
                            required: false
                        },{
                            name: 'required',
                            lable: '是否必填',
                            value: false,
                            type: 'check',
                            required: false
                        },{
                            name: 'rules',
                            lable: '校验规则',
                            value: '',
                            type: 'select',
                            required: false
                        },{
                            name: 'minLength',
                            lable: '最小文本长度',
                            value: '',
                            type: 'number',
                            required: false
                        },{
                            name: 'maxLength',
                            lable: '最大文本长度',
                            value: '',
                            type: 'number',
                            required: false
                        }]
                    },{
                        title: "多行文本",
                        type: 'textarea',
                        src: 'images/d-textarea.png',
                        parm: [
                            {
                                name: 'name',
                                lable: '字段名称',
                                value: '',
                                type: 'text',
                                required: true
                            },{
                                name: 'default',
                                lable: '默认值',
                                value: '',
                                type: 'text',
                                required: false
                            },{
                                name: 'required',
                                lable: '是否必填',
                                value: false,
                                type: 'check',
                                required: false
                            },{
                                name: 'rules',
                                lable: '校验规则',
                                value: '',
                                type: 'select',
                                required: false
                            },{
                                name: 'minLength',
                                lable: '最小文本长度',
                                value: '',
                                type: 'number',
                                required: false
                            },{
                                name: 'maxLength',
                                lable: '最大文本长度',
                                value: '',
                                type: 'number',
                                required: false
                            }]
                },{
                        title: "数值",
                        type: 'number',
                        src: 'images/d-textarea.png',
                        parm: [
                            {
                                name: 'name',
                                lable: '字段名称',
                                value: '',
                                type: 'text',
                                required: true
                            },{
                                name: 'default',
                                lable: '默认值',
                                value: '',
                                type: 'text',
                                required: false
                            },{
                                name: 'unit',
                                lable: '单位',
                                value: '',
                                type: 'text',
                                required: false
                            },{
                                name: 'required',
                                lable: '是否必填',
                                value: false,
                                type: 'check',
                                required: false
                            },{
                                name: 'minDigit',
                                lable: '最小位数',
                                value: '',
                                type: 'number',
                                required: false
                            },{
                                name: 'minLength',
                                lable: '最小文本长度',
                                value: '',
                                type: 'number',
                                required: false
                            },{
                                name: 'maxLength',
                                lable: '最大文本长度',
                                value: '',
                                type: 'number',
                                required: false
                            }]
                    },{
                        title: "下拉",
                        type: 'pulldown',
                        src: 'images/d-select.png',
                        parm: [
                            {
                                name: 'name',
                                lable: '字段名称',
                                value: '',
                                type: 'text',
                                required: true
                            },{
                                name: 'required',
                                lable: '是否必填',
                                value: false,
                                type: 'check',
                            },{
                                name: 'options',
                                lable: '选项',
                                value: '',
                                type: 'options',
                                options: []
                            }]
                    },{
                    title: "多选",
                    type: 'checkbox',
                    src: 'images/d-checkgroup.png',
                    parm: [
                            {
                                name: 'name',
                                lable: '字段名称',
                                value: '',
                                type: 'text',
                                required: true
                            },{
                                name: 'required',
                                lable: '是否必填',
                                value: false,
                                type: 'check',
                            },{
                                name: 'options',
                                lable: '选项',
                                value: '',
                                type: 'options',
                                options: []
                            }]
                },{
                    title: "单选",
                    type: 'radio',
                    src: 'images/d-check.png',
                    parm: [
                            {
                                name: 'name',
                                lable: '字段名称',
                                value: '',
                                type: 'text',
                                required: true
                            },{
                                name: 'required',
                                lable: '是否必填',
                                value: false,
                                type: 'check',
                            },{
                                name: 'options',
                                lable: '选项',
                                value: '',
                                type: 'options',
                                options: []
                            }]
                },{
                    title: "日期和时间",
                    type: 'dateTime',
                    src: 'images/d-date.png',
                    parm: [
                            {
                                name: 'name',
                                lable: '字段名称',
                                value: '',
                                type: 'text',
                                required: true
                            },{
                                name: 'required',
                                lable: '是否必填',
                                value: false,
                                type: 'check',
                            },{
                                name: 'required_data',
                                lable: '仅日期',
                                value: false,
                                type: 'check',
                            },{
                                name: 'dateTime',
                                lable: '默认值',
                                value: '',
                                type: 'dateTime',
                            }]
                },{
                    title: "属性分组",
                    type: 'number',
                    src: 'images/d-group.png'
                },{
                    title: "表格",
                    type: 'table',
                    src: 'images/d-table.png',
                    parm: [
                            {
                                name: 'name',
                                lable: '字段名称',
                                value: '',
                                type: 'text',
                                required: true
                            },{
                                name: 'required',
                                lable: '是否必填',
                                value: false,
                                type: 'check',
                            },{
                                name: 'table',
                                lable: '列名',
                                value: false,
                                type: 'options',
                                options: []
                            }]
                },{
                    title: "引用",
                    type: 'useobj',
                    src: 'images/d-quote.png',
                    parm: [
                            {
                                name: 'name',
                                lable: '字段名称',
                                value: '',
                                type: 'text',
                                required: true
                            },{
                                name: 'required',
                                lable: '是否必填',
                                value: false,
                                type: 'check',
                            },{
                                name: 'useobj',
                                lable: '引用对象',
                                value: '',
                                type: 'select',
                            }]
                },{
                    title: "附件",
                    type: 'file',
                    src: 'images/d-file.png',
                    parm: [
                            {
                                name: 'name',
                                lable: '字段名称',
                                value: '',
                                type: 'text',
                                required: true
                            },{
                                name: 'code',
                                lable: '字段编码',
                                value: '',
                                type: 'text',
                                required: true
                            },{
                                name: 'required',
                                lable: '是否必填',
                                value: false,
                                type: 'check',
                            }]
                }],
                form:{}
            }
        },
        created() {
            this.selectNav(this.left_nav[0])
        },
        mounted() {
            this.$nextTick(function(){
        		layui.use(['element', 'table', 'form', 'jquery', 'laydate'], function () {
			        var element = layui.element;
			        var table = layui.table;
			        var form = layui.form;
			        var $ = layui.jquery;
			        var laydate = layui.laydate;
	            })
            })
            
			
        },
        methods: {
            handleDrop(data) {
                console.log(data)
                if(!data){ return }
                this.cur_drap = JSON.parse(JSON.stringify(data))
                this.msgBoxShow = true
                this.$nextTick(function () {
                    layui.use(['form','laydate'], function(){
                        layui.form.render()
                        layui.laydate.render({
				            elem: '#laydata',
				            type: "date"
				        });
                    });
                });
            },
            //保存拖拽添加
            saveDrap() {
               	this.msgBoxShow = false
                var rules = this.$refs.rules ? this.$refs.rules[0].value : ''
                var required = this.$refs.required ? this.$refs.required[0].checked : ''
                var required_data = this.$refs.required_data ? this.$refs.required_data[0].checked : ''
                var dateTime = this.$refs.dateTime ? this.$refs.dateTime[0].value : ''
                this.cur_drap.parm.forEach((item)=>{
                    if(rules && item.name=='rules'){ item.value = rules }
                    if(item.name=='required'){ item.value = required }
                    if(item.name=='required_data'){ item.value = required_data }
                    if(item.name=='dateTime'){ item.value = dateTime }
                })
                this.addBasicInfo()
            },
            addBasicInfo() {
            	console.log(this.cur_drap)
            	console.log(this.left_nav)
            	var newAddObj = {}
            	newAddObj = this.cur_drap
            	this.cur_drap.parm.forEach((parm)=>{
            		if(parm.name=='name'){ newAddObj.title = parm.value }
            		if(parm.name=='required'){ newAddObj.required = parm.value }
            		if(parm.name=='default'){ newAddObj.value = parm.value}
            	})
            	this.left_nav.forEach((item)=>{
            		if(item.selected){
            			item.attr.push(newAddObj)
            		}
            	})
            	console.log(this.left_nav[0])
            	console.log(this.cur_select)	
            },
            selectNav(item) {
                this.left_nav.forEach((i)=>{
                    i.selected = false
                    if(i.id == item.id){
                        i.selected = true
                        this.cur_select = i
                    }
                })
            },
            addOption(item){
                console.log(item)
                item.options.push({
                    isSelect: false,
                    name: ''
                })
                this.$nextTick(function () {
                    layui.use(['form'], function(){
                        layui.form.render()
                    });
                });
            },
            checkOption(item,index) {
              item.options.forEach((i)=>{
                  i.isSelect = false
                  item.options[index].isSelect = true
              })
            },
            navEdit() {
                console.log(123)
            }
        }
    })
</script>
<script src="lib/layui/layui.js"></script>
</body>
</html>
